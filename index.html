<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galleria – Cartella "Image"</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Galleria responsive per mostrare immagini dalla cartella Image/ su GitHub Pages." />
  <style>
    /* Piccoli ritocchi non-opinabili (non colori) */
    .card { transition: transform .25s ease, box-shadow .25s ease; }
    .card:hover { transform: translateY(-2px); }
    .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="min-h-screen bg-neutral-100 text-neutral-900">
  <!-- Shell -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/80 border-b border-neutral-200">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-7 h-7" fill="currentColor" aria-hidden="true"><path d="M21 19V7a2 2 0 0 0-2-2h-2V3h-2v2H9V3H7v2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM5 9h14v10H5V9Z"/></svg>
      <div class="grow">
        <h1 class="text-xl font-semibold">Galleria immagini</h1>
        <p class="text-sm text-neutral-600">Mostra le immagini in <code>Image/</code> con card e lista.</p>
      </div>
      <a href="Image/" class="text-sm underline decoration-dotted" target="_blank" rel="noopener">Apri cartella</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Controls -->
    <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between mb-6">
      <div class="flex items-center gap-2 w-full md:w-auto">
        <input id="search" type="search" placeholder="Cerca per nome…" class="w-full md:w-72 border border-neutral-300 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black/10" />
        <select id="sort" class="border border-neutral-300 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black/10">
          <option value="name-asc">Nome A→Z</option>
          <option value="name-desc">Nome Z→A</option>
        </select>
      </div>
      <div class="flex items-center gap-2">
        <button id="gridBtn" class="toggle-view px-3 py-2 rounded-xl border border-neutral-300 bg-white">Griglia</button>
        <button id="listBtn" class="toggle-view px-3 py-2 rounded-xl border border-neutral-300 bg-white">Lista</button>
      </div>
    </div>

    <!-- Griglia -->
    <section id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
      <!-- Cards generate here -->
    </section>

    <!-- Lista -->
    <section id="list" class="hidden">
      <ul id="listContainer" class="divide-y divide-neutral-200 bg-white rounded-2xl shadow-sm"></ul>
    </section>

    <!-- Stato / Errori -->
    <p id="status" class="mt-6 text-sm text-neutral-500"></p>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="fixed inset-0 hidden items-center justify-center bg-black/80 p-4 z-50">
    <button id="closeLightbox" class="absolute top-4 right-4 bg-white/90 hover:bg-white rounded-full p-2" aria-label="Chiudi">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6" fill="currentColor"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.3 1.41 1.41Z"/></svg>
    </button>
    <img id="lightboxImg" src="" alt="Anteprima" class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl"/>
    <div id="lightboxCaption" class="absolute bottom-6 left-1/2 -translate-x-1/2 bg-white/90 px-3 py-1 rounded-lg text-sm"></div>
  </div>

  <footer class="max-w-6xl mx-auto px-4 py-10 text-xs text-neutral-500">
    <p>Carica le immagini nella cartella <code>Image/</code>. Puoi anche creare un file <code>images.json</code> (array di stringhe) nella root per generare la lista in automatico.</p>
  </footer>

  <script>
    // === CONFIGURAZIONE ===
    const IMAGE_DIR = 'Image/';

    // Fallback locale (opzionale) se GitHub API non è disponibile
    let IMAGES = [
      // "esempio.jpg"
    ];

    // ====== 1) TENTATIVO AUTOMATICO: LISTA FILE CON GITHUB API ======
    // Funziona su GitHub Pages (dominio *.github.io). Non richiede token (limite 60 req/ora IP).
    function detectRepoInfo() {
      const { hostname, pathname } = window.location;
      const info = { owner: null, repo: null, branchCandidates: ['gh-pages','main','master'] };
      if (hostname.endsWith('.github.io')) {
        const owner = hostname.replace('.github.io','');
        const parts = pathname.replace(/^\//,'').split('/').filter(Boolean);
        // User/Org site: https://owner.github.io/ (repo is typically owner.github.io)
        // Project site: https://owner.github.io/repo/
        info.owner = owner;
        info.repo = parts.length ? parts[0] : `${owner}.github.io`;
      }
      return info;
    }

    async function fetchImageListFromGitHub() {
      const repoInfo = detectRepoInfo();
      if (!repoInfo.owner || !repoInfo.repo) return null;

      const exts = /\.(jpe?g|png|gif|webp|svg|avif)$/i;
      for (const branch of repoInfo.branchCandidates) {
        const apiUrl = `https://api.github.com/repos/${repoInfo.owner}/${repoInfo.repo}/contents/${IMAGE_DIR}?ref=${branch}`;
        try {
          const res = await fetch(apiUrl, { headers: { 'Accept': 'application/vnd.github+json' } });
          if (!res.ok) continue; // prova ramo successivo
          const data = await res.json();
          if (!Array.isArray(data)) continue;
          const files = data
            .filter(it => it.type === 'file' && exts.test(it.name))
            .map(it => ({ name: it.name, url: `https://raw.githubusercontent.com/${repoInfo.owner}/${repoInfo.repo}/${branch}/${IMAGE_DIR}${it.name}` }));
          if (files.length) return files;
        } catch (_) { /* ignora e prova prossimo branch */ }
      }
      return null;
    }

    // ====== 2) FALLBACK: images.json nella root ======
    async function tryLoadManifest() {
      try {
        const res = await fetch('images.json', { cache: 'no-store' });
        if (!res.ok) return null;
        const arr = await res.json();
        if (Array.isArray(arr) && arr.length) {
          return arr.map(name => ({ name, url: IMAGE_DIR + name }));
        }
      } catch (_) {}
      return null;
    }

    // ====== Utility ======
    function toItem(nameOrObj) {
      if (typeof nameOrObj === 'string') {
        return { name: nameOrObj, url: IMAGE_DIR + nameOrObj };
      }
      return nameOrObj;
    }
    function toAlt(name) { return name.replace(/[_-]+/g, ' ').replace(/\.[^.]+$/, ''); }

    // Rendering griglia
    function renderGrid(items) {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      const frag = document.createDocumentFragment();
      for (const it of items) {
        const alt = toAlt(it.name);
        const card = document.createElement('article');
        card.className = 'card group bg-white rounded-2xl shadow-sm ring-1 ring-neutral-200/60 overflow-hidden';
        card.innerHTML = `
          <div class="relative aspect-[4/3] bg-neutral-100 overflow-hidden">
            <img data-src="${it.url}" alt="${alt}" loading="lazy" class="w-full h-full object-cover group-hover:scale-[1.02] transition-transform"/>
            <a href="${it.url}" download class="absolute bottom-3 right-3 text-xs bg-white/90 hover:bg-white px-2 py-1 rounded-lg shadow">Scarica</a>
          </div>
          <div class="p-4 flex items-center gap-3">
            <div class="shrink-0 w-10 h-10 bg-neutral-100 rounded-xl grid place-items-center">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5" fill="currentColor"><path d="M21 19V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2Zm-2 0H5V7h14v12Z"/></svg>
            </div>
            <div class="min-w-0">
              <h3 class="text-sm font-medium line-clamp-1" title="${it.name}">${it.name}</h3>
              <p class="text-xs text-neutral-500">${it.url}</p>
            </div>
          </div>
        `;
        card.querySelector('img').addEventListener('click', () => openLightbox({ ...it, alt }));
        frag.appendChild(card);
      }
      grid.appendChild(frag);

      const imgs = grid.querySelectorAll('img[data-src]');
      const io = new IntersectionObserver((entries, obs) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            const img = entry.target; img.src = img.dataset.src; img.removeAttribute('data-src'); obs.unobserve(img);
          }
        }
      }, { rootMargin: '200px' });
      imgs.forEach(img => io.observe(img));
    }

    // Rendering lista
    function renderList(items) {
      const list = document.getElementById('listContainer');
      list.innerHTML = '';
      const frag = document.createDocumentFragment();
      for (const it of items) {
        const alt = toAlt(it.name);
        const li = document.createElement('li');
        li.className = 'flex items-center gap-3 px-4 py-3 hover:bg-neutral-50';
        li.innerHTML = `
          <img src="${it.url}" alt="${alt}" loading="lazy" class="w-14 h-10 object-cover rounded-lg ring-1 ring-neutral-200/60"/>
          <div class="min-w-0 grow">
            <p class="text-sm font-medium truncate" title="${it.name}">${it.name}</p>
            <p class="text-xs text-neutral-500">${it.url}</p>
          </div>
          <div class="flex items-center gap-2">
            <a href="${it.url}" target="_blank" class="text-sm underline decoration-dotted">Apri</a>
            <a href="${it.url}" download class="text-sm">Scarica</a>
          </div>
        `;
        li.querySelector('img').addEventListener('click', () => openLightbox({ ...it, alt }));
        frag.appendChild(li);
      }
      list.appendChild(frag);
    }

    // Lightbox helpers
    function openLightbox(it) {
      const lb = document.getElementById('lightbox');
      document.getElementById('lightboxImg').src = it.url;
      document.getElementById('lightboxCaption').textContent = it.name;
      lb.classList.remove('hidden');
      lb.classList.add('flex');
    }
    function closeLight() {
      const lb = document.getElementById('lightbox');
      lb.classList.add('hidden');
      lb.classList.remove('flex');
      document.getElementById('lightboxImg').src = '';
    }

    // Stato UI
    function setStatus(msg) { document.getElementById('status').textContent = msg || ''; }

    // Ricerca e ordinamento
    function applyFilters(items) {
      const q = document.getElementById('search').value.trim().toLowerCase();
      const sort = document.getElementById('sort').value;
      let filtered = items.filter(it => it.name.toLowerCase().includes(q));
      filtered.sort((a, b) => sort === 'name-desc' ? b.name.localeCompare(a.name) : a.name.localeCompare(b.name));
      return filtered;
    }

    function renderAll(items) {
      const filtered = applyFilters(items);
      renderGrid(filtered);
      renderList(filtered);
      setStatus(filtered.length ? '' : 'Nessun risultato.');
    }

    // View toggle
    function setView(mode) {
      const grid = document.getElementById('grid');
      const list = document.getElementById('list');
      if (mode === 'grid') { grid.classList.remove('hidden'); list.classList.add('hidden'); }
      else { list.classList.remove('hidden'); grid.classList.add('hidden'); }
      document.getElementById('gridBtn').classList.toggle('bg-black', mode==='grid');
      document.getElementById('gridBtn').classList.toggle('text-white', mode==='grid');
      document.getElementById('listBtn').classList.toggle('bg-black', mode==='list');
      document.getElementById('listBtn').classList.toggle('text-white', mode==='list');
    }

    // Inizializzazione
    (async function init() {
      setView('grid');
      setStatus('Carico elenco immagini…');

      let items = [];

      // 1) Prova GitHub API (auto)
      const ghItems = await fetchImageListFromGitHub();
      if (ghItems && ghItems.length) {
        items = ghItems.map(toItem);
      } else {

  <!--
  ISTRUZIONI RAPIDE
  1) Metti questa pagina come index.html nella root del tuo repo GitHub Pages.
  2) Crea la cartella Image/ e carica le tue immagini (jpg, png, webp, ecc.).
  3) Metodo veloce: inserisci i nomi file nell'array IMAGES qui sopra, ad es.
       let IMAGES = ["cover1.jpg", "poster.png", "foto-roma.webp"]; 
     Metodo comodo: crea images.json nella root (stesso livello di index.html) con:
       ["cover1.jpg", "poster.png", "foto-roma.webp"]
     e la pagina le caricherà automaticamente.
  4) Commit & push. Fine.
  -->
</body>
</html>
