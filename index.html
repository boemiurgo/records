<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galleria â€“ Cartella "Image"</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-neutral-100 text-neutral-900">
  <main class="max-w-6xl mx-auto px-4 py-6">
    <h1 class="text-2xl font-bold mb-6">Galleria immagini</h1>
    <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
  </main>

  <script>
    const IMAGE_DIR = 'Image/';
    const SUPPORTED = ['jpg','jpeg','png','gif','webp','svg','avif'];

    async function loadImages() {
      const repoInfo = (() => {
        const { hostname, pathname } = window.location;
        if (!hostname.endsWith('.github.io')) return null;
        const owner = hostname.replace('.github.io','');
        const parts = pathname.replace(/^\//,'').split('/').filter(Boolean);
        return { owner, repo: parts[0] || `${owner}.github.io` };
      })();
      if (!repoInfo) return [];
      const branches = ['gh-pages','main','master'];
      for (const branch of branches) {
        const apiUrl = `https://api.github.com/repos/${repoInfo.owner}/${repoInfo.repo}/contents/${IMAGE_DIR}?ref=${branch}`;
        try {
          const res = await fetch(apiUrl);
          if (!res.ok) continue;
          const data = await res.json();
          return data.filter(f => f.type==='file' && SUPPORTED.some(ext=>f.name.toLowerCase().endsWith(ext)))
                     .map(f => ({ name:f.name, url:`https://raw.githubusercontent.com/${repoInfo.owner}/${repoInfo.repo}/${branch}/${IMAGE_DIR}${f.name}` }));
        } catch(e){}
      }
      return [];
    }

    function render(images) {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      images.forEach(img => {
        const card = document.createElement('div');
        card.className = "bg-white rounded-xl shadow p-2 flex flex-col items-center";
        card.innerHTML = `
          <img src="${img.url}" alt="${img.name}" class="object-cover w-full h-48 rounded-md mb-2">
          <p class="text-sm text-center truncate w-full">${img.name}</p>
        `;
        gallery.appendChild(card);
      });
    }

    (async function(){
      const images = await loadImages();
      render(images);
    })();
  </script>
</body>
</html>
